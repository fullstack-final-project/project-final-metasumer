<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper
	namespace="com.spring_boot_final.metasumer.dao.IMemberDAO">
	<resultMap id="mbResult"
		type="com.spring_boot_final.metasumer.model.MemberVO">
		<result property="memId" column="memId" />
		<result property="memPwd" column="memPwd" />
		<result property="memName" column="memName" />
		<result property="memEmail" column="memEmail" />
		<result property="memNickname" column="memNickname" />
		<result property="memHP" column="memHP" />
		<result property="memZipcode" column="memZipcode" />
		<result property="memAddress1" column="memAddress1" />
		<result property="memAddress2" column="memAddress2" />
		<result property="memGender" column="memGender" />
		<result property="memJoinDate" column="memJoinDate" />
		<result property="memType" column="memType" />
		<result property="categoryName" column="categoryName" />
		<result property="tagName" column="tagName" />
		<result property="tagId" column="tagId" />
	</resultMap>
	
	<select id="loginCheck" parameterType="hashmap" resultType="string">
  		SELECT memPwd FROM member WHERE memId=#{id}
  	</select>

	<select id="categoryList" resultMap="mbResult">
  		SELECT interestId, categoryName
        FROM interestcategory
  	</select>
  	
	<select id="tagList" resultMap="mbResult">
  		SELECT interestId, tagName, tagId
        FROM interesttag
  	</select>
  	
  	<select id="userTagList" resultMap="mbResult">
  		SELECT m.memId, t.tagId, t.tagName, t.interestId,c.categoryName
		FROM memberInterest m
		JOIN interesttag t ON m.tagId = t.tagId
		JOIN interestcategory c ON t.interestId = c.interestId
		WHERE m.memId = #{memId}
  	</select>
  	
  	<insert id="saveInterests" parameterType="map">
        INSERT INTO memberInterest (memId, tagId)
        VALUES
        <foreach collection="tagIds" item="tagId" separator=",">
            (#{memId}, #{tagId})
        </foreach>
    </insert>
	
    <select id="getUsermemNickname" parameterType="string" resultType="map">
        SELECT memNickname, memType
        FROM member
        WHERE memId = #{id}
    </select>
    
    <insert id="insertMember" parameterType="com.spring_boot_final.metasumer.model.MemberVO">
    INSERT INTO member (
        memId, memPwd, memName, memEmail, memNickname, memHP, memZipcode, memAddress1, memAddress2, memGender, memJoinDate, memType
    ) VALUES (
        #{memId}, #{memPwd}, #{memName}, #{memEmail}, #{memNickname}, #{memHP}, #{memZipcode}, #{memAddress1}, #{memAddress2}, #{memGender}, CURDATE(), #{memType}
    );
	</insert>
	
	<select id="memIdCheck" parameterType="string" resultType="int">
        SELECT COUNT(*)
        FROM member
        WHERE memId = #{memId}
    </select>
    
	<select id="memNicknameCheck" parameterType="string" resultType="int">
        SELECT COUNT(*)
        FROM member
        WHERE memNickname = #{memNickname}
    </select>
	
</mapper>